name: Bare-Metal ARM CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install arm-none-eabi-gcc
        uses: fiam/arm-none-eabi-gcc@v1
        with:
          release: "9-2019-q4"

      - name: Build firmware
        shell: powershell
        run: make all

      - name: Check ELF size
        shell: powershell
        run: arm-none-eabi-size build/bin/main.elf

      - name: Dump ELF sections
        shell: powershell
        run: arm-none-eabi-objdump -h -s build/bin/main.elf

      - name: Upload ELF artifact
        uses: actions/upload-artifact@v4
        with:
          name: stm32-build
          path: build/bin/main.elf
